# High availability test
# Tests: Multiple replicas, autoscaling, PDB

pypiserver:
  replicaCount: 2

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 4
    targetCPUUtilizationPercentage: 80

storage:
  backend: local
  local:
    enabled: true
    size: 5Gi
    accessMode: ReadWriteOnce

auth:
  enabled: true
  method: htpasswd
  htpasswd:
    # Username: testuser, Password: testpass
    content: |
      testuser:$2y$10$KurSfbKU0QGTDFG03W5GxeLif/0PVrTXyoZFL5SRV1wsgqpc717aS

ingress:
  enabled: true
  className: nginx
  hosts:
    - host: pypi.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

monitoring:
  prometheus:
    enabled: true
    serviceMonitor:
      enabled: false

podDisruptionBudget:
  enabled: true
  minAvailable: 1

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - pypiserver
          topologyKey: kubernetes.io/hostname
